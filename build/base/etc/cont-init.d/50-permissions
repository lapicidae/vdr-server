#!/usr/bin/with-contenv bash

### User and group assignments should be in "/etc/fix-attrs.d/"
### !!! this file is also called at finish !!!


## default mount points (docker volumes)
declare -a chmown=("/etc/vdr"
		   "/srv/vdr/video"
		   "/var/cache/vdr"
		   "/var/lib/vdr"
		  )

for f in "${chmown[@]}"
do
	echo "Reassign permissions: $f"
	chown -R vdr:vdr "$f"
	find "$f" -mindepth 1 -type d -exec chmod 775 {} \;
	find "$f" -mindepth 1 -type f -exec chmod 664 {} \;
done


## Plugins
# live
live_dir="/vdr/config/plugins/live"
if [ -f "$live_dir/live.pem" ]; then
	chmod ug+r $live_dir/live.pem
fi
if [ -f "$live_dir/live-key.pem" ]; then
	chmod ug+r $live_dir/live-key.pem
fi

# ciplus
ci_plus="/vdr/cache/plugins/ciplus/"
if [ -d "$ci_plus" ] && [ ! -z "$(ls -A $ci_plus)" ]; then
	chmod -f ug+rw *.auth || true
fi
