/**
 * UIkit Custom Extension Plugin
 * * This plugin extends UIkit 3 by:
 * 1. Registering custom SVG icons for the interface.
 * 2. Applying global mixin configurations for UIkit components (Tooltips).
 * 3. Preventing tooltips from reappearing after modal closure using a method wrapper.
 * @param {Object} global - The global window or self object.
 * @param {Function} factory - The factory function that creates the plugin.
 */
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define('uikitcustom', factory) :
	(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.UIkitCustom = factory());
})(this, (function () { 'use strict';

	/**
	 * The actual UIkit plugin function.
	 * * @param {Object} UIkit - The UIkit instance.
	 */
	function plugin(UIkit) {
		if (plugin.installed) {
			return;
		}

		/**
		 * State management for modal transitions.
		 */
		let isModalClosing = false;
		let lastPointerTime = 0;

		// Track last pointer activity to distinguish between mouse hover and system focus
		UIkit.util.on(document, 'pointerdown pointerup mousemove', () => {
			lastPointerTime = Date.now();
		});

		UIkit.util.on(document, 'beforehide', '.uk-modal', function () {
			isModalClosing = true;
		});

		UIkit.util.on(document, 'hidden', '.uk-modal', function () {
			// Time window to catch the focus restoration after modal is gone
			setTimeout(() => {
				isModalClosing = false;
			}, 100);
		});

		/**
		 * Global Tooltip Mixin
		 * Wraps the 'show' method to respect modal state and prevent tab-switch triggers.
		 */
		UIkit.mixin({
			data: {
				delay: 300
			},
			beforeConnect() {
				const originalShow = this.show;
				this.show = () => {
					const isRecentPointer = (Date.now() - lastPointerTime) < 50;

					// Block if modal is closing OR if focus happened without mouse activity (tab switch)
					if (isModalClosing || !isRecentPointer) {
						return;
					}
					return originalShow.apply(this);
				};
			}
		}, 'tooltip');

		/**
		 * Custom Icon Registrations
		 * Adds project-specific SVG icons to the UIkit icon library.
		 */
		UIkit.icon.add({
			"mute": '<svg width="20" height="20" viewBox="0 0 20 20"><path d="m11.156 1.8359-5.7617 4.6113h-4.2207v7.1055h4.2207l5.7617 4.6113zm-1 2.3457v11.637l-4.0801-3.2656h-3.9023v-5.1055h3.9023z"/><path d="m18.588 6.8999-6.2001 6.2001m0-6.2001 6.2001 6.2001" stroke="#000"/></svg>',
			"pause": '<svg width="20" height="20" viewBox="0 0 20 20"><rect x="7.4176" y="4.0977" width="1" height="11.805"/><rect x="11.582" y="4.0977" width="1" height="11.805"/></svg>',
			// "x": '<svg width="20" height="20" viewBox="0 0 20 20"><path d="m15.464 1.4129h2.9135l-6.365 7.2748 7.488 9.8994h-5.863l-4.5921-6.0039-5.2544 6.0039h-2.9152l6.808-7.7813-7.1832-9.393h6.0119l4.1509 5.4878zm-1.0225 15.43h1.6144l-10.421-13.778h-1.7324z"/></svg>',
			"touch": '<svg width="20" height="20" viewBox="0 0 20 20"><path d="m6.0558 0.50227c-1.3435-0.03933-2.6859 0.43377-3.7237 1.3804-1.6604 1.5146-2.1833 3.9159-1.3025 5.9835 0.88083 2.0676 2.9747 3.3542 5.2173 3.2061a0.30491 0.30491 0 0 0 0.28387-0.32469 0.30491 0.30491 0 0 0-0.32283-0.28387c-1.9862 0.13119-3.836-1.0056-4.6161-2.8368-0.78014-1.8313-0.31843-3.9519 1.1522-5.2933 1.4706-1.3414 3.6248-1.6071 5.3768-0.66236 1.752 0.94473 2.7135 2.8897 2.4008 4.8555a0.30491 0.30491 0 0 0 0.25418 0.35066 0.30491 0.30491 0 0 0 0.34881-0.25418c0.1324-0.83232 0.062275-1.6619-0.18182-2.4305-0.40684-1.281-1.2962-2.391-2.5326-3.0576-0.74182-0.4-1.5483-0.60908-2.3545-0.63268zm-0.15956 1.9147c-1.4633 0.0099137-2.8027 0.97884-3.2228 2.4454-0.49781 1.7381 0.46878 3.5669 2.1856 4.1337a0.30619 0.30619 0 0 0 0.38777-0.19481 0.30619 0.30619 0 0 0-0.19481-0.38591c-1.4108-0.46577-2.1995-1.9559-1.7904-3.3842 0.40907-1.4283 1.8665-2.2739 3.31-1.9222 1.4435 0.35171 2.3477 1.772 2.0539 3.2283a0.30619 0.30619 0 0 0 0.23934 0.3618 0.30619 0.30619 0 0 0 0.35994-0.23934c0.11173-0.55384 0.081177-1.105-0.068648-1.6142-0.32962-1.1203-1.2321-2.0379-2.4398-2.3322-0.27447-0.066876-0.5491-0.098315-0.82007-0.096479zm-0.040818 1.8925c-0.23772 0.0059087-0.47802 0.06993-0.69762 0.19667-0.70285 0.40579-0.9457 1.3102-0.53991 2.0131l4.3248 7.4901-1.514-0.744c-0.81906-0.40276-1.8163-0.06392-2.219 0.75513-0.40276 0.81905-0.062073 1.8144 0.75699 2.2172l5.3119 2.6142c2.6038 1.2804 5.1126 0.53058 6.6199-1.0854 1.5073-1.616 2.0475-4.1092 0.80894-6.2544l-2.5251-4.3749c-0.36968-0.64031-1.1965-0.86135-1.8368-0.49167-0.25845 0.14921-0.44784 0.37327-0.55846 0.62897-0.46171-0.43276-1.171-0.53602-1.7459-0.20409-0.31238 0.18035-0.53348 0.45943-0.64752 0.77554-0.46194-0.39711-1.1436-0.48234-1.6995-0.16142-0.27961 0.16144-0.48461 0.40182-0.6067 0.67721l-1.9147-3.3155c-0.27898-0.48321-0.79417-0.74958-1.3173-0.73658zm0.018554 0.6067c0.30604-0.0094 0.6035 0.14581 0.76997 0.43415l2.5103 4.3471 1.3173 2.2802c0.08541 0.14319 0.26936 0.19283 0.41374 0.10947 0.14438-0.08336 0.19448-0.26819 0.11318-0.41374l-1.3155-2.2802c-0.24198-0.41938-0.10393-0.93976 0.31541-1.1819 0.41941-0.24215 0.93972-0.10215 1.1819 0.31727l1.6272 2.8164c0.08446 0.14629 0.26931 0.19578 0.4156 0.11132s0.19578-0.26931 0.11132-0.4156l-1.3043-2.2617c-0.24215-0.41941-0.104-0.93786 0.31541-1.18 0.41941-0.24215 0.93972-0.104 1.1819 0.31541l1.59 2.7534c0.08459 0.14652 0.26931 0.19578 0.4156 0.11132 0.14629-0.08446 0.19592-0.26908 0.11132-0.4156l-1.2616-2.1875c-0.20587-0.35683-0.08963-0.79775 0.26717-1.0037 0.35687-0.20604 0.79772-0.087833 1.0038 0.26903l2.527 4.3749c1.0982 1.9022 0.61772 4.0926-0.7273 5.5345-1.345 1.442-3.5219 2.1258-5.9056 0.95366l-5.3119-2.6123c-0.52535-0.25834-0.73702-0.8773-0.47868-1.4027 0.25834-0.52536 0.8773-0.73702 1.4027-0.47868l2.4138 1.1874c0.12046 0.05919 0.26453 0.03307 0.35623-0.06494 0.091698-0.098 0.10974-0.24368 0.042673-0.35994l-4.8258-8.3584c-0.24215-0.41941-0.10215-0.93972 0.31727-1.1819 0.13107-0.075672 0.27093-0.11262 0.41004-0.11689z"/></svg>',
			// "threads": '<svg width="20" height="20" viewBox="0 0 20 20"><path d="m14.547 9.3061c-0.081838-0.039227-0.16496-0.07698-0.24918-0.11313-0.14666-2.7022-1.6232-4.2493-4.1025-4.2651-0.01123-6.92e-5 -0.0224-6.92e-5 -0.03364-6.92e-5 -1.4829 0-2.7163 0.633-3.4754 1.7849l1.3635 0.93536c0.5671-0.86039 1.4571-1.0438 2.1125-1.0438 0.0076 0 0.01517 0 0.02266 6.93e-5 0.81635 0.00521 1.4324 0.24256 1.8311 0.70542 0.29015 0.33698 0.4842 0.80265 0.58029 1.3903-0.72378-0.12302-1.5065-0.16084-2.3433-0.11286-2.3572 0.13578-3.8726 1.5106-3.7708 3.4209 0.05165 0.969 0.53438 1.8026 1.3592 2.3472 0.6974 0.46035 1.5956 0.68548 2.5291 0.63452 1.2328-0.06759 2.1999-0.53794 2.8746-1.398 0.51241-0.65312 0.8365-1.4995 0.97959-2.566 0.58752 0.35457 1.0229 0.82116 1.2634 1.3821 0.4089 0.95346 0.43274 2.5203-0.8457 3.7976-1.1201 1.119-2.4665 1.6031-4.5014 1.6181-2.2572-0.01672-3.9642-0.7406-5.0741-2.1516-1.0393-1.3212-1.5764-3.2295-1.5965-5.672 0.02004-2.4425 0.55716-4.3508 1.5965-5.672 1.1099-1.4109 2.8169-2.1348 5.0741-2.1516 2.2735 0.016902 4.0104 0.74426 5.1627 2.162 0.56505 0.69524 0.99107 1.5696 1.2719 2.589l1.5979-0.42632c-0.34042-1.2548-0.87608-2.3361-1.605-3.2328-1.4773-1.8176-3.638-2.7489-6.4219-2.7683h-0.01114c-2.7783 0.019244-4.9147 0.95414-6.35 2.7787-1.2772 1.6236-1.936 3.8828-1.9581 6.7146l-6.9e-5 0.00668 6.9e-5 0.0067c0.02214 2.8318 0.68095 5.0911 1.9581 6.7147 1.4353 1.8245 3.5717 2.7595 6.35 2.7787h0.01114c2.47-0.01712 4.2111-0.66381 5.6454-2.0968 1.8765-1.8748 1.82-4.2247 1.2016-5.6673-0.44373-1.0345-1.2897-1.8747-2.4465-2.4297zm-4.2648 4.0097c-1.0331 0.05819-2.1064-0.40553-2.1594-1.3988-0.03923-0.73645 0.5241-1.5582 2.2228-1.6561 0.19453-0.01122 0.38542-0.0167 0.57295-0.0167 0.617 0 1.1942 0.05994 1.719 0.17466-0.19574 2.4445-1.3439 2.8414-2.3554 2.8969z"/></svg>',
			"snapchat": '<svg width="20" height="20" viewBox="0 0 20 20"><path d="m18.914 14.531c-0.0775-0.2583-0.4521-0.43915-0.4521-0.43915-0.03355-0.02065-0.06715-0.03615-0.093-0.0491-0.62255-0.29965-1.1728-0.6613-1.6352-1.0721-0.37195-0.33065-0.6923-0.6923-0.94805-1.0797-0.31255-0.47015-0.4598-0.8654-0.5218-1.0773-0.03615-0.1395-0.0284-0.19375 0-0.26605 0.02585-0.0594 0.0956-0.11885 0.13175-0.14465 0.20925-0.14725 0.54765-0.36685 0.7543-0.50115 0.17825-0.11625 0.33325-0.217 0.42365-0.279 0.2919-0.2041 0.49085-0.41075 0.60965-0.6355 0.1524-0.2893 0.1705-0.60965 0.05165-0.9222-0.16015-0.42365-0.5554-0.6768-1.0566-0.6768-0.11105 0-0.2273 0.012897-0.34095 0.036152-0.28675 0.062002-0.5606 0.16535-0.7879 0.25315-0.0155 0.00775-0.0336-0.00518-0.0336-0.023248 0.02325-0.5657 0.0517-1.3252-0.0103-2.0485-0.05685-0.65356-0.1912-1.2038-0.41075-1.6843-0.22215-0.48306-0.5063-0.83955-0.73365-1.0953-0.2144-0.2454-0.58895-0.60706-1.1573-0.93255-0.7982-0.45723-1.7075-0.68972-2.702-0.68972-0.99195 0-1.8987 0.23249-2.6995 0.68714-0.5993 0.34357-0.9842 0.73105-1.1598 0.93255-0.22476 0.25832-0.5115 0.61481-0.73366 1.0953-0.21957 0.48048-0.3539 1.0307-0.41073 1.6843-0.062 0.72333-0.036165 1.4234-0.010335 2.0485 0 0.018051-0.01808 0.030998-0.03358 0.023248-0.22732-0.087848-0.50115-0.1912-0.78789-0.2532-0.11367-0.0258-0.22732-0.036152-0.34099-0.036152-0.50114 0-0.89638 0.25315-1.0565 0.6768-0.11883 0.31515-0.10074 0.6329 0.051665 0.92225 0.11883 0.2247 0.31774 0.4314 0.60964 0.63545 0.090415 0.062 0.24541 0.16275 0.42366 0.279 0.20408 0.13175 0.53214 0.34355 0.74139 0.4934 0.02583 0.0181 0.11366 0.08525 0.14208 0.155 0.031 0.0749 0.036165 0.12915-0.00258 0.2764-0.064585 0.2144-0.21182 0.6045-0.51923 1.0669-0.25574 0.38745-0.57606 0.7491-0.94805 1.0797-0.46498 0.41075-1.0152 0.7724-1.6352 1.072-0.028415 0.01295-0.06458 0.031-0.10333 0.05425-0.038749 0.02325-0.37199 0.1886-0.44174 0.434-0.10333 0.36165 0.17049 0.70005 0.45465 0.88345 0.45982 0.2971 1.0204 0.45725 1.3459 0.5425 0.090415 0.02325 0.17308 0.0465 0.24799 0.06975 0.0465 0.0155 0.16274 0.0594 0.21441 0.124 0.062 0.0801 0.06975 0.1808 0.092995 0.2945 0.03617 0.19115 0.11625 0.4262 0.35132 0.58895 0.25832 0.17825 0.58898 0.1912 1.0049 0.2067 0.43657 0.0155 0.97905 0.03875 1.599 0.2428 0.28675 0.0956 0.54765 0.25575 0.8499 0.44175 0.6303 0.38745 1.4156 0.87055 2.7563 0.87055 1.3408 0 2.1312-0.48565 2.7667-0.87315 0.29965-0.1834 0.55795-0.34355 0.83955-0.43655 0.61995-0.2041 1.1624-0.22475 1.599-0.24285 0.4159-0.0155 0.74655-0.0284 1.0049-0.20665 0.25315-0.1731 0.3255-0.434 0.35905-0.6303 0.0181-0.0956 0.031-0.1834 0.08525-0.25575 0.0465-0.062 0.155-0.10335 0.20665-0.1214 0.0775-0.02325 0.1602-0.0465 0.25575-0.07235 0.3255-0.08785 0.73105-0.18855 1.227-0.47015 0.5864-0.3358 0.62775-0.7517 0.56575-0.9558z"/></svg>',
			"stop": '<svg width="20" height="20" viewBox="0 0 20 20"><rect x="4.098" y="4.098" width="11.804" height="11.804" fill="none" stroke="#000"/></svg>',
			"volume": '<svg width="20" height="20" viewBox="0 0 20 20"><path d="m11.156 1.8359-5.7617 4.6113h-4.2207v7.1055h4.2207l5.7617 4.6113zm-1 2.3457v11.637l-4.0801-3.2656h-3.9023v-5.1055h3.9023z"/><path d="m15.969 3.3223-0.70312 0.70508c1.6529 1.4575 2.6934 3.5912 2.6934 5.9727 0 2.3811-1.0409 4.5152-2.6934 5.9727l0.70312 0.70312c1.834-1.6413 2.9902-4.025 2.9902-6.6758 0-2.6512-1.1558-5.0364-2.9902-6.6777z"/><path d="m13.77 5.5234-0.70703 0.70508c1.0944 0.88925 1.793 2.2469 1.793 3.7715 0 1.5244-0.69686 2.8822-1.791 3.7715l0.70508 0.70508c1.2746-1.075 2.0859-2.6829 2.0859-4.4766 0-1.7939-0.81104-3.4015-2.0859-4.4766z"/></svg>'
		});

		plugin.installed = true;
	}

	/**
	 * Auto-install the plugin if UIkit is globally available.
	 */
	if (typeof window !== "undefined" && window.UIkit) {
		window.UIkit.use(plugin);
	}

	return plugin;

}));


// vim: ts=4 sw=4 noet:
// kate: space-indent off; indent-width 4; mixed-indent off;
